---
layout: post
title:  "Tik-tak"
description: "Jak ulepszyć czasomierze w przeglądarce?"
author: Comandeer
date: 2025-02-15T00:25:00+0100
project: czasomierze
tags:
    - javascript
    - eksperymenty
comments: true
permalink: /tik-tak.html
---

W przeglądarce dostępnych jest dużo różnych API. Niektóre z nich nieustannie ewoluują czy wręcz zostają zastąpione przez nowsze, lepiej zaprojektowane API. Inne z kolei wydają się całkiem zapomniane – jak choćby czasomierze (<i lang="en">timers</i>). Ostatnio używałem ich w małym projekcie i naszła mnie garść refleksji, którymi postanowiłem się podzielić ze światem. <!--more-->

## Czym są czasomierze?

Czasomierze (liczniki czasu, timery) to przeglądarkowe API, które służy do odliczania czasu. Jest [dokładnie opisane w specyfikacji HTML](https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#timers) i składa się z czterech globalnych funkcji:

* [`setTimeout()`](https://developer.mozilla.org/en-US/docs/Web/API/Window/setTimeout) – służące do jednorazowego odliczenia czasu i wykonania po tym czasie jakiejś czynności,
* [`setInterval()`](https://developer.mozilla.org/en-US/docs/Web/API/Window/setInterval) – służące do wykonywania jakiejś czynności co określony czas,
* [`clearTimeout()`](https://developer.mozilla.org/en-US/docs/Web/API/Window/clearTimeout) – służące do anulowania odliczania czasu rozpoczętego przy pomocy `setTimeout()`,
* [`clearInterval()`](https://developer.mozilla.org/en-US/docs/Web/API/Window/clearInterval) – służące do anulowania odliczania czasu rozpoczętego przy pomocy `setInterval()`.

Przy ustawianiu czasomierza należy podać czynność, którą chcemy wykonać, oraz czas, po jakim ma zostać wykonana (w przypadku `setTimeout()`), lub odstęp między poszczególnymi wykonaniami czynności (w przypadku `setInterval()`):

```javascript
setTimeout( () => {
	console.log( 'timeout' ); // 2
}, 5000 ); // 1

setInterval( () => {
	console.log( 'tik' ); // 4
}, 1000 ); // 3
```

W przypadku `setTimeout()`  chcemy, żeby po 5 sekundach (1) wyświetlił się w konsoli napis `'timeout'` (2). W przypadku `setInterval()` z kolei chcemy, żeby co sekundę (3) wyświetlał się w konsoli napis `'tik'` (4). Warto przy tym zwrócić uwagę na dwie rzeczy. Pierwsza z nich to fakt, że czas należy podać w milisekundach. Druga to fakt, że _nie ma_ gwarancji, że czasomierz dokładnie odmierzy podany czas. Przeglądarka zagwarantuje jedynie, że odmierzy _co najmniej_ tyle, ile jej kazano – a więc _co najmniej_ 5 sekund w przypadku `setTimeout()` oraz _co najmniej_ sekundę w przypadku `setInterval()`. Zależy to od wielu czynników, m.in. od tego, czy przeglądarka ma akurat "wolne", czy procesor nie jest zajęty przez coś innego, czy okno przeglądarki jest sfocusowane, itd.

Zarówno `setTimeout()`, jak i `setInterval()` zwracają id, które może być następnie użyte w `clearTimeout()` i `clearInterval()`:

```javascript
const timeoutId = setTimeout( timeoutHandler, 5000 );
const intervalId = setInterval( intervalHandler, 1000 );

clearTimeout( timeoutId );
clearInterval( intervalId );
```

Żeby nie było za prosto, `clearTimeout()` zadziała też dla czasomierza stworzonego przez `setInterval()`, a `clearInterval()` – dla czasomierza stworzonego przez `setTimeout()`. Wynika to z tego, że [standard przewiduje wspólną kolejkę dla obydwu typów czasomierzy](https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#map-of-settimeout-and-setinterval-ids).
